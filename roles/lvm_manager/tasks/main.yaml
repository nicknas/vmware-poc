---

- name: Map unit_number to Linux disk letter
  ansible.builtin.set_fact:
    disk_letter_map:
      0: "a"
      1: "b"
      2: "c"
      3: "d"
      4: "e"
      5: "f"
      6: "g"
      7: "h"
      8: "i"
      9: "j"
      10: "k"  


- set_fact:
    disk_letter: "{{ ['a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v','w','x','y','z'][lvm_unit_number | int] }}"

- set_fact:
    lvm_disk_name: "sd{{ disk_letter }}"


- debug:
    msg: "{{ lvm_disk_name }}"

- name: Map disk path
  ansible.builtin.set_fact:
    lvm_disk_path: "/dev/sd{{ disk_letter_map[lvm_unit_number | string] }}"

- name: Ensure new disk is available
  wait_for:
    path: "{{ lvm_disk_path }}"
    timeout: 30

- name: Extend existing LVM
  ansible.builtin.include_tasks: extend_lvm.yaml
  when: lvm_action == "extend"

- name: Create new PV/VG/LV
  ansible.builtin.include_tasks: create_lvm.yaml
  when: lvm_action == "create"
